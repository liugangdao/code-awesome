# flash sale function

## 秒杀功能的业务流程可以大致分为以下几个步骤：

1. 用户请求; 
用户请求进入秒杀页面或发起秒杀请求。
系统先进行限流（防止用户请求过多）。
2. 库存校验; 
系统从缓存（Redis）中读取库存数据。
若库存大于 0，则进入下一个流程，若库存为 0，则返回秒杀失败。
3. 队列排队;
如果秒杀商品数量有限，且并发请求过多，可以将请求加入队列，按照顺序逐一处理。
请求进入队列后，可以进一步进行库存的扣减。

4. 扣减库存;
使用 Redis 锁或数据库的乐观锁机制，保证库存扣减操作的原子性。
扣减成功后，更新库存数据，并返回秒杀成功。

5. 订单生成;
库存扣减成功后，生成订单并持久化。
如果秒杀失败，返回库存不足信息。

![秒杀系统流程](https://github.com/liugangdao/code-awesome/blob/master/flash_sale_func/doc/flashsale.png?raw=true)

## 注意事项
1. 高并发：当秒杀请求极为密集时，考虑使用消息队列（如 Kafka）来进一步优化并发流量处理。

2. 限流优化：漏桶算法可以进一步优化为支持不同速率和容量的配置，例如不同商品可以设置不同的漏桶容量和漏出速率。
3. 监控与报警：可以监控 Redis 的性能和漏桶的使用情况，设置报警机制，以便在秒杀流量异常时及时响应。